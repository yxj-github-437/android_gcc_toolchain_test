name: android gcc builds

on: [push]

env:
  NDK_VERSION: 28c

jobs:
  prepare_ndk:
    runs-on: ubuntu-latest
    steps:
      - name: cache ndk
        uses: actions/cache@v4
        id: ndk-cache
        with:
          path: /opt/ndk
          key: ${{ runner.os }}-ndk-r${{ env.NDK_VERSION }}
          restore-keys: ${{ runner.os }}-ndk-

      - name: download ndk
        run: |
            if [ ! -d "/opt/ndk/" ]; then
              # 下载NDK
              wget -q https://dl.google.com/android/repository/android-ndk-r$NDK_VERSION-linux.zip
              unzip -q android-ndk-r$NDK_VERSION-linux.zip -d /opt/
              mv /opt/android-ndk-r$NDK_VERSION /opt/ndk
              echo "ANDROID_NDK_HOME=/opt/ndk" >> $GITHUB_ENV
            fi
        if: steps.ndk-cache.outputs.cache-hit != 'true'

  test_ndk:
    runs-on: ubuntu-latest
    needs: prepare_ndk
    steps:
      - name: restore ndk
        uses: actions/cache@v4
        with:
          path: /opt/ndk/
          key: ${{ runner.os }}-ndk-r${{ env.NDK_VERSION }}
          restore-keys: ${{ runner.os }}-ndk-

      - name: check clang
        run: |
          /opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/clang++ -v





